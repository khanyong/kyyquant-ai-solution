{
  "name": "í‚¤ì›€ ìë™ë§¤ë§¤ ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "1ë¶„ë§ˆë‹¤ ì‹¤í–‰",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "http://kiwoom-bridge:8001/api/market/current-price",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "stock_code",
              "value": "005930"
            }
          ]
        },
        "options": {}
      },
      "id": "get-price",
      "name": "í˜„ì¬ê°€ ì¡°íšŒ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ë§¤ë§¤ ì‹ í˜¸ ìƒì„± ë¡œì§\nconst currentPrice = $input.item.json.data.output.stck_prpr;\nconst previousClose = $input.item.json.data.output.stck_sdpr;\n\n// ê°„ë‹¨í•œ ì˜ˆì‹œ: ì „ì¼ ì¢…ê°€ ëŒ€ë¹„ -2% ì´í•˜ë©´ ë§¤ìˆ˜\nconst changeRate = ((currentPrice - previousClose) / previousClose) * 100;\n\nif (changeRate <= -2) {\n  return {\n    signal: 'buy',\n    stock_code: '005930',\n    price: currentPrice,\n    reason: `ì „ì¼ ëŒ€ë¹„ ${changeRate.toFixed(2)}% í•˜ë½`\n  };\n} else if (changeRate >= 3) {\n  return {\n    signal: 'sell',\n    stock_code: '005930',\n    price: currentPrice,\n    reason: `ì „ì¼ ëŒ€ë¹„ ${changeRate.toFixed(2)}% ìƒìŠ¹`\n  };\n}\n\nreturn {\n  signal: 'hold',\n  stock_code: '005930',\n  price: currentPrice,\n  reason: 'ì‹ í˜¸ ì—†ìŒ'\n};"
      },
      "id": "trading-signal",
      "name": "ë§¤ë§¤ ì‹ í˜¸ ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.signal }}",
              "operation": "notEqual",
              "value2": "hold"
            }
          ]
        }
      },
      "id": "check-signal",
      "name": "ì‹ í˜¸ í™•ì¸",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "url": "http://kiwoom-bridge:8001/api/trading/order",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "user_id",
              "value": "={{ $env.USER_ID }}"
            },
            {
              "name": "stock_code",
              "value": "={{ $json.stock_code }}"
            },
            {
              "name": "order_type",
              "value": "={{ $json.signal }}"
            },
            {
              "name": "quantity",
              "value": "1"
            },
            {
              "name": "price",
              "value": "0"
            },
            {
              "name": "order_method",
              "value": "01"
            }
          ]
        },
        "options": {}
      },
      "id": "place-order",
      "name": "ì£¼ë¬¸ ì‹¤í–‰",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1050, 250]
    },
    {
      "parameters": {
        "url": "={{ $env.DISCORD_WEBHOOK_URL }}",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content",
              "value": "ğŸ¤– **ìë™ë§¤ë§¤ ì•Œë¦¼**\n\nğŸ“Š ì¢…ëª©: {{ $json.stock_code }}\nğŸ’¹ ì‹ í˜¸: {{ $json.signal === 'buy' ? 'ë§¤ìˆ˜' : 'ë§¤ë„' }}\nğŸ’° ê°€ê²©: {{ $json.price }}ì›\nğŸ“ ì‚¬ìœ : {{ $json.reason }}\nâ° ì‹œê°„: {{ $now.format('YYYY-MM-DD HH:mm:ss') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "send-notification",
      "name": "ë””ìŠ¤ì½”ë“œ ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1250, 250]
    }
  ],
  "connections": {
    "schedule-trigger": {
      "main": [
        [
          {
            "node": "get-price",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-price": {
      "main": [
        [
          {
            "node": "trading-signal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "trading-signal": {
      "main": [
        [
          {
            "node": "check-signal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-signal": {
      "main": [
        [
          {
            "node": "place-order",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "place-order": {
      "main": [
        [
          {
            "node": "send-notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateId": "kiwoom-auto-trading"
  },
  "pinData": {}
}