{
  "name": "ê±°ë˜ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼",
  "nodes": [
    {
      "parameters": {
        "events": [
          {
            "table": "orders",
            "event": "INSERT"
          },
          {
            "table": "orders",
            "event": "UPDATE"
          }
        ]
      },
      "id": "supabase-trigger",
      "name": "ì£¼ë¬¸ ì´ë²¤íŠ¸ ê°ì§€",
      "type": "n8n-nodes-base.supabaseTrigger",
      "typeVersion": 1,
      "position": [250, 300],
      "credentials": {
        "supabaseApi": {
          "id": "1",
          "name": "Supabase Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.status}}",
              "operation": "equals",
              "value2": "EXECUTED"
            }
          ]
        }
      },
      "id": "check-execution",
      "name": "ì²´ê²° í™•ì¸",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "operation": "select",
        "schema": "public", 
        "table": "strategies",
        "limit": 1,
        "where": {
          "condition": "AND",
          "conditions": [
            {
              "field": "id",
              "value": "={{$json.strategy_id}}"
            }
          ]
        }
      },
      "id": "get-strategy-info",
      "name": "ì „ëµ ì •ë³´ ì¡°íšŒ",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [650, 250],
      "credentials": {
        "supabaseApi": {
          "id": "1",
          "name": "Supabase Account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "trading@yourdomain.com",
        "toEmail": "={{$env.ADMIN_EMAIL}}",
        "subject": "ğŸ”” ìë™ë§¤ë§¤ ì²´ê²°: {{$json.order_type}} {{$json.stock_name}}",
        "text": "=",
        "html": "<h2>ì£¼ë¬¸ ì²´ê²° ì•Œë¦¼</h2>\n<p><strong>ì „ëµ:</strong> {{$json.strategy_name}}</p>\n<p><strong>ì¢…ëª©:</strong> {{$json.stock_name}} ({{$json.stock_code}})</p>\n<p><strong>ì£¼ë¬¸ ìœ í˜•:</strong> {{$json.order_type}}</p>\n<p><strong>ì²´ê²° ìˆ˜ëŸ‰:</strong> {{$json.executed_quantity}}ì£¼</p>\n<p><strong>ì²´ê²° ê°€ê²©:</strong> {{$json.executed_price}}ì›</p>\n<p><strong>ì²´ê²° ì‹œê°„:</strong> {{$json.executed_time}}</p>\n<hr>\n<p>ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì—ì„œ ë°œì†¡ëœ ë©”ì¼ì…ë‹ˆë‹¤.</p>",
        "options": {}
      },
      "id": "send-email",
      "name": "ì´ë©”ì¼ ì•Œë¦¼",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [850, 250],
      "credentials": {
        "smtp": {
          "id": "2",
          "name": "SMTP Account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "webhook",
        "webhookUri": "={{$env.SLACK_WEBHOOK_URL}}",
        "text": "=",
        "attachments": [
          {
            "color": "={{$json.order_type === 'BUY' ? '#00ff00' : '#ff0000'}}",
            "title": "ìë™ë§¤ë§¤ ì²´ê²° ì•Œë¦¼",
            "fields": {
              "item": [
                {
                  "short": true,
                  "title": "ì „ëµ",
                  "value": "={{$json.strategy_name}}"
                },
                {
                  "short": true,
                  "title": "ì¢…ëª©",
                  "value": "={{$json.stock_name}}"
                },
                {
                  "short": true,
                  "title": "ì£¼ë¬¸",
                  "value": "={{$json.order_type}}"
                },
                {
                  "short": true,
                  "title": "ìˆ˜ëŸ‰",
                  "value": "={{$json.executed_quantity}}ì£¼"
                },
                {
                  "short": true,
                  "title": "ê°€ê²©",
                  "value": "{{$json.executed_price}}ì›"
                },
                {
                  "short": true,
                  "title": "ì‹œê°„",
                  "value": "={{$json.executed_time}}"
                }
              ]
            }
          }
        ],
        "options": {}
      },
      "id": "send-slack",
      "name": "Slack ì•Œë¦¼",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [850, 350]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.status}}",
              "operation": "equals",
              "value2": "FAILED"
            }
          ]
        }
      },
      "id": "check-failure",
      "name": "ì‹¤íŒ¨ í™•ì¸",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 450]
    },
    {
      "parameters": {
        "fromEmail": "trading@yourdomain.com",
        "toEmail": "={{$env.ADMIN_EMAIL}}",
        "subject": "âš ï¸ ìë™ë§¤ë§¤ ì˜¤ë¥˜: {{$json.error_message}}",
        "text": "ì£¼ë¬¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì „ëµ: {{$json.strategy_name}}\nì¢…ëª©: {{$json.stock_name}}\nì˜¤ë¥˜: {{$json.error_message}}\nì‹œê°„: {{$json.created_at}}",
        "options": {
          "priority": "high"
        }
      },
      "id": "error-notification",
      "name": "ì˜¤ë¥˜ ì•Œë¦¼",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [650, 450],
      "credentials": {
        "smtp": {
          "id": "2",
          "name": "SMTP Account"
        }
      }
    }
  ],
  "connections": {
    "ì£¼ë¬¸ ì´ë²¤íŠ¸ ê°ì§€": {
      "main": [
        [
          {
            "node": "ì²´ê²° í™•ì¸",
            "type": "main",
            "index": 0
          },
          {
            "node": "ì‹¤íŒ¨ í™•ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì²´ê²° í™•ì¸": {
      "main": [
        [
          {
            "node": "ì „ëµ ì •ë³´ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì „ëµ ì •ë³´ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ì´ë©”ì¼ ì•Œë¦¼",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì‹¤íŒ¨ í™•ì¸": {
      "main": [
        [
          {
            "node": "ì˜¤ë¥˜ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true
  },
  "tags": [
    {
      "name": "monitoring"
    }
  ]
}