{
  "name": "Supabase-Kiwoom ÏûêÎèôÎß§Îß§ (Credentials Î≤ÑÏ†Ñ)",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 1
            }
          ]
        }
      },
      "id": "trigger",
      "name": "‚è∞ 1Î∂ÑÎßàÎã§ Ïã§Ìñâ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://hznkyaomtrpzcayayayh.supabase.co/rest/v1/strategies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "is_active",
              "value": "eq.true"
            },
            {
              "name": "select",
              "value": "*"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{$credentials.apikey}}"
            }
          ]
        }
      },
      "id": "get-strategies",
      "name": "üìä ÌôúÏÑ± Ï†ÑÎûµ Ï°∞Ìöå",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [450, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://hznkyaomtrpzcayayayh.supabase.co/rest/v1/trading_signals",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "order",
              "value": "created_at.desc"
            },
            {
              "name": "limit",
              "value": "5"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{$credentials.apikey}}"
            }
          ]
        }
      },
      "id": "get-signals",
      "name": "üìà ÏµúÍ∑º Ïã†Ìò∏ Ï°∞Ìöå",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [650, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.length}}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "check-signals",
      "name": "‚ùì Ïã†Ìò∏ ÌôïÏù∏",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://mockapi.kiwoom.com/oauth2/token",
        "authentication": "none",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"grant_type\": \"client_credentials\",\n  \"appkey\": \"{{$credentials.kiwoomApi.appKey}}\",\n  \"secretkey\": \"{{$credentials.kiwoomApi.appSecret}}\"\n}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json;charset=UTF-8"
            }
          ]
        }
      },
      "id": "kiwoom-auth",
      "name": "üîê ÌÇ§ÏõÄ Ïù∏Ï¶ù",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1050, 250],
      "credentials": {
        "customAuth": {
          "id": "2",
          "name": "Kiwoom API"
        }
      },
      "notes": "Custom Auth Credential ÏÇ¨Ïö©"
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://mockapi.kiwoom.com/uapi/domestic-stock/v1/trading/inquire-balance",
        "authentication": "none",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "CANO",
              "value": "{{$credentials.kiwoomApi.accountNo}}"
            },
            {
              "name": "ACNT_PRDT_CD",
              "value": "01"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "authorization",
              "value": "Bearer {{$node['kiwoom-auth'].json.access_token}}"
            },
            {
              "name": "appkey",
              "value": "{{$credentials.kiwoomApi.appKey}}"
            },
            {
              "name": "appsecret",
              "value": "{{$credentials.kiwoomApi.appSecret}}"
            },
            {
              "name": "tr_id",
              "value": "VTTC8434R"
            }
          ]
        }
      },
      "id": "get-balance",
      "name": "üí∞ Í≥ÑÏ¢å ÏûîÍ≥† Ï°∞Ìöå",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1250, 250],
      "credentials": {
        "customAuth": {
          "id": "2",
          "name": "Kiwoom API"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://hznkyaomtrpzcayayayh.supabase.co/rest/v1/account_balance",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"user_id\": \"n8n-system\",\n  \"account_number\": \"{{$credentials.kiwoomApi.accountNo}}\",\n  \"total_assets\": {{$json.output2.tot_evlu_amt || 0}},\n  \"available_cash\": {{$json.output2.nass_amt || 0}},\n  \"total_profit\": {{$json.output2.tot_evlu_pfls_amt || 0}},\n  \"profit_rate\": {{$json.output2.tot_evlu_pfls_rt || 0}}\n}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{$credentials.apikey}}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "return=minimal"
            }
          ]
        }
      },
      "id": "save-balance",
      "name": "üíæ ÏûîÍ≥† Ï†ÄÏû•",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1450, 250],
      "credentials": {
        "httpHeaderAuth": {
          "id": "1",
          "name": "Supabase API"
        }
      }
    }
  ],
  "connections": {
    "trigger": {
      "main": [
        [
          {
            "node": "get-strategies",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-strategies": {
      "main": [
        [
          {
            "node": "get-signals",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-signals": {
      "main": [
        [
          {
            "node": "check-signals",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "check-signals": {
      "main": [
        [
          {
            "node": "kiwoom-auth",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "kiwoom-auth": {
      "main": [
        [
          {
            "node": "get-balance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get-balance": {
      "main": [
        [
          {
            "node": "save-balance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}