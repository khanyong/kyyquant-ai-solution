# ğŸ¢ 10ëª… ì´ë‚´ ë‹¤ì¤‘ ì‚¬ìš©ì ìë™ë§¤ë§¤ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## âœ… ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
- **ë™ì‹œ ì‚¬ìš©ì**: ìµœëŒ€ 10ëª…
- **ì‚¬ìš©ìë³„ ë…ë¦½ ê³„ì¢Œ**: ê°ìì˜ í‚¤ì›€/í•œíˆ¬ ê³„ì¢Œ
- **ê°œë³„ ì „ëµ ì‹¤í–‰**: ì‚¬ìš©ìë‹¹ 1-5ê°œ ì „ëµ
- **ì‹¤ì‹œê°„ ì‹œì„¸ ê³µìœ **: ëª¨ë“  ì‚¬ìš©ì ë™ì¼ ë°ì´í„°

## ğŸ¯ 10ëª… ê·œëª¨ì— ìµœì í™”ëœ êµ¬ì¡°

### 1ï¸âƒ£ ë‹¨ì¼ Windows ì„œë²„ + ì„¸ì…˜ ê´€ë¦¬ ë°©ì‹ (ê¶Œì¥)

```yaml
ì¥ì :
  - ë¹„ìš© íš¨ìœ¨ì  (Windows ì„œë²„ 1ëŒ€)
  - ê´€ë¦¬ ë‹¨ìˆœ
  - 10ëª… ê·œëª¨ì— ì¶©ë¶„í•œ ì„±ëŠ¥
  
êµ¬í˜„ ë°©ì‹:
  - ì‚¬ìš©ì ìš”ì²­ íì‰ ì‹œìŠ¤í…œ
  - 30ì´ˆ ë‹¨ìœ„ ì„¸ì…˜ ë¡œí…Œì´ì…˜
  - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì²˜ë¦¬
```

### ğŸ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              10ëª…ì˜ ì‚¬ìš©ì                       â”‚
â”‚   User1  User2  User3 ... User9  User10        â”‚
â”‚     â†“      â†“      â†“        â†“      â†“           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Vercel + Supabase (Cloud)              â”‚
â”‚                                                â”‚
â”‚  âœ… ì‚¬ìš©ì ì¸ì¦ (Supabase Auth)                 â”‚
â”‚  âœ… ì „ëµ ì €ì¥ (strategies í…Œì´ë¸”)               â”‚
â”‚  âœ… ì£¼ë¬¸ ê¸°ë¡ (orders í…Œì´ë¸”)                   â”‚
â”‚  âœ… í¬íŠ¸í´ë¦¬ì˜¤ (portfolio í…Œì´ë¸”)               â”‚
â”‚  âœ… API í‚¤ ê´€ë¦¬ (user_api_credentials)         â”‚
â”‚                                                â”‚
â”‚  [RLSë¡œ ì‚¬ìš©ìë³„ ë°ì´í„° ì™„ì „ ê²©ë¦¬]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         NAS Docker Container                   â”‚
â”‚         (ì„¸ì…˜ ë§¤ë‹ˆì € & í ì‹œìŠ¤í…œ)                â”‚
â”‚                                                â”‚
â”‚  class SessionManager:                         â”‚
â”‚    - 10ê°œ ì‚¬ìš©ì ì„¸ì…˜ í’€ ê´€ë¦¬                    â”‚
â”‚    - 30ì´ˆ ë‹¨ìœ„ ë¡œí…Œì´ì…˜                         â”‚
â”‚    - ìš°ì„ ìˆœìœ„ í (VIP > ì¼ë°˜)                   â”‚
â”‚    - ê¸´ê¸‰ ì£¼ë¬¸ ìš°ì„  ì²˜ë¦¬                        â”‚
â”‚                                                â”‚
â”‚  class OrderQueue:                             â”‚
â”‚    - FIFO ì£¼ë¬¸ ì²˜ë¦¬                            â”‚
â”‚    - ì‚¬ìš©ìë³„ ì¼ì¼ í•œë„ ì²´í¬                     â”‚
â”‚    - ë™ì‹œ ì£¼ë¬¸ ìˆ˜ ì œí•œ (10ê±´/ì´ˆ)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Windows Server (í‚¤ì›€ API ì‹¤í–‰)             â”‚
â”‚                                                â”‚
â”‚  KiwoomAPIPool:                                â”‚
â”‚    - ë™ì  ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ                       â”‚
â”‚    - ê³„ì • ì „í™˜ (3ì´ˆ ì†Œìš”)                       â”‚
â”‚    - ì‹¤ì‹œê°„ ì‹œì„¸ëŠ” ê³µìœ                          â”‚
â”‚    - ì£¼ë¬¸ì€ ìˆœì°¨ ì²˜ë¦¬                           â”‚
â”‚                                                â”‚
â”‚  ì²˜ë¦¬ ëŠ¥ë ¥:                                     â”‚
â”‚    - ë¶„ë‹¹ 20ê°œ ì£¼ë¬¸ ì²˜ë¦¬                        â”‚
â”‚    - 10ëª… ê¸°ì¤€ ì‚¬ìš©ìë‹¹ 2ê°œ ì£¼ë¬¸/ë¶„              â”‚
â”‚    - ì‹¤ì‹œê°„ ì‹œì„¸ 100ì¢…ëª© ë™ì‹œ êµ¬ë…              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’» êµ¬í˜„ ì½”ë“œ

### 1. ì„¸ì…˜ ë§¤ë‹ˆì € (Python)

```python
# nas_server/session_manager.py
import asyncio
from typing import Dict, Optional
from datetime import datetime, timedelta
import queue
from dataclasses import dataclass

@dataclass
class UserSession:
    user_id: str
    api_key: str
    api_secret: str
    account_no: str
    priority: int  # 0=ì¼ë°˜, 1=VIP
    last_active: datetime
    daily_trades: int
    daily_limit: int = 100

class MultiUserSessionManager:
    def __init__(self, max_users=10):
        self.max_users = max_users
        self.sessions: Dict[str, UserSession] = {}
        self.active_session: Optional[str] = None
        self.order_queue = queue.PriorityQueue()
        self.kiwoom_api = None
        self.rotation_interval = 30  # 30ì´ˆë§ˆë‹¤ ì„¸ì…˜ êµì²´
        
    async def add_user(self, user_id: str, credentials: dict, priority=0):
        """ì‚¬ìš©ì ì„¸ì…˜ ì¶”ê°€"""
        if len(self.sessions) >= self.max_users:
            raise Exception(f"ìµœëŒ€ ì‚¬ìš©ì ìˆ˜({self.max_users}ëª…) ì´ˆê³¼")
        
        self.sessions[user_id] = UserSession(
            user_id=user_id,
            api_key=credentials['api_key'],
            api_secret=credentials['api_secret'],
            account_no=credentials['account_no'],
            priority=priority,
            last_active=datetime.now(),
            daily_trades=0
        )
        
    async def get_next_session(self) -> Optional[UserSession]:
        """ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ë‹¤ìŒ ì„¸ì…˜ ì„ íƒ"""
        # VIP ì‚¬ìš©ì ìš°ì„ 
        vip_users = [s for s in self.sessions.values() 
                     if s.priority == 1 and s.daily_trades < s.daily_limit]
        if vip_users:
            return min(vip_users, key=lambda x: x.last_active)
        
        # ì¼ë°˜ ì‚¬ìš©ì
        normal_users = [s for s in self.sessions.values() 
                        if s.priority == 0 and s.daily_trades < s.daily_limit]
        if normal_users:
            return min(normal_users, key=lambda x: x.last_active)
        
        return None
    
    async def switch_session(self, user_id: str):
        """í‚¤ì›€ API ì„¸ì…˜ ì „í™˜"""
        if self.active_session == user_id:
            return True
        
        session = self.sessions.get(user_id)
        if not session:
            return False
        
        # í˜„ì¬ ì„¸ì…˜ ë¡œê·¸ì•„ì›ƒ
        if self.active_session:
            await self.kiwoom_logout()
        
        # ìƒˆ ì„¸ì…˜ ë¡œê·¸ì¸ (3ì´ˆ ì†Œìš”)
        success = await self.kiwoom_login(
            session.api_key,
            session.api_secret,
            session.account_no
        )
        
        if success:
            self.active_session = user_id
            session.last_active = datetime.now()
        
        return success
    
    async def process_order_queue(self):
        """ì£¼ë¬¸ í ì²˜ë¦¬ (ë¬´í•œ ë£¨í”„)"""
        while True:
            try:
                # íì—ì„œ ì£¼ë¬¸ ê°€ì ¸ì˜¤ê¸°
                priority, timestamp, order = await asyncio.get_event_loop().run_in_executor(
                    None, self.order_queue.get, True, 1
                )
                
                # ì„¸ì…˜ ì „í™˜
                await self.switch_session(order['user_id'])
                
                # ì£¼ë¬¸ ì‹¤í–‰
                result = await self.execute_order(order)
                
                # ì¼ì¼ ê±°ë˜ ì¹´ìš´íŠ¸ ì¦ê°€
                session = self.sessions[order['user_id']]
                session.daily_trades += 1
                
                # ê²°ê³¼ ì €ì¥
                await self.save_order_result(order['user_id'], result)
                
            except queue.Empty:
                await asyncio.sleep(0.1)
            except Exception as e:
                print(f"ì£¼ë¬¸ ì²˜ë¦¬ ì˜¤ë¥˜: {e}")
    
    async def add_order(self, user_id: str, order: dict):
        """ì£¼ë¬¸ íì— ì¶”ê°€"""
        session = self.sessions.get(user_id)
        if not session:
            raise Exception("ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ì")
        
        if session.daily_trades >= session.daily_limit:
            raise Exception("ì¼ì¼ ê±°ë˜ í•œë„ ì´ˆê³¼")
        
        # ìš°ì„ ìˆœìœ„ íì— ì¶”ê°€ (VIP ìš°ì„ )
        priority = 0 if session.priority == 1 else 1
        self.order_queue.put((priority, datetime.now(), {
            'user_id': user_id,
            **order
        }))
    
    async def get_shared_market_data(self):
        """ëª¨ë“  ì‚¬ìš©ìê°€ ê³µìœ í•˜ëŠ” ì‹¤ì‹œê°„ ì‹œì„¸"""
        # í•œ ë²ˆì˜ API í˜¸ì¶œë¡œ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
        return self.kiwoom_api.get_realtime_prices()
```

### 2. FastAPI ì„œë²„ ì—”ë“œí¬ì¸íŠ¸

```python
# nas_server/main.py
from fastapi import FastAPI, HTTPException, Depends
from fastapi.middleware.cors import CORSMiddleware
import asyncio

app = FastAPI()
session_manager = MultiUserSessionManager(max_users=10)

# CORS ì„¤ì •
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-app.vercel.app"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.on_event("startup")
async def startup_event():
    """ì„œë²„ ì‹œì‘ì‹œ ì„¸ì…˜ ë§¤ë‹ˆì € ì´ˆê¸°í™”"""
    # ì£¼ë¬¸ í ì²˜ë¦¬ ì‹œì‘
    asyncio.create_task(session_manager.process_order_queue())
    
    # Supabaseì—ì„œ í™œì„± ì‚¬ìš©ì ë¡œë“œ
    users = await load_active_users()
    for user in users[:10]:  # ìµœëŒ€ 10ëª…
        await session_manager.add_user(
            user['id'],
            user['credentials'],
            user['priority']
        )

@app.post("/api/orders")
async def create_order(order_data: dict, user_id: str = Depends(get_current_user)):
    """ì£¼ë¬¸ ìƒì„± API"""
    try:
        # ì£¼ë¬¸ ê²€ì¦
        if not validate_order(order_data):
            raise HTTPException(400, "ì˜ëª»ëœ ì£¼ë¬¸")
        
        # íì— ì¶”ê°€
        await session_manager.add_order(user_id, order_data)
        
        return {"status": "queued", "message": "ì£¼ë¬¸ì´ ëŒ€ê¸°ì—´ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤"}
        
    except Exception as e:
        raise HTTPException(400, str(e))

@app.get("/api/queue-status")
async def get_queue_status(user_id: str = Depends(get_current_user)):
    """ì‚¬ìš©ìë³„ í ìƒíƒœ ì¡°íšŒ"""
    session = session_manager.sessions.get(user_id)
    if not session:
        raise HTTPException(404, "ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    
    return {
        "daily_trades": session.daily_trades,
        "daily_limit": session.daily_limit,
        "remaining": session.daily_limit - session.daily_trades,
        "queue_size": session_manager.order_queue.qsize(),
        "is_active": session_manager.active_session == user_id
    }

@app.websocket("/ws/market-data")
async def market_data_websocket(websocket: WebSocket):
    """ì‹¤ì‹œê°„ ì‹œì„¸ WebSocket (ëª¨ë“  ì‚¬ìš©ì ê³µìœ )"""
    await websocket.accept()
    
    try:
        while True:
            # ëª¨ë“  ì‚¬ìš©ìê°€ ë™ì¼í•œ ì‹œì„¸ ë°ì´í„° ìˆ˜ì‹ 
            market_data = await session_manager.get_shared_market_data()
            await websocket.send_json(market_data)
            await asyncio.sleep(1)  # 1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
            
    except Exception as e:
        print(f"WebSocket ì˜¤ë¥˜: {e}")
    finally:
        await websocket.close()
```

### 3. ì‚¬ìš©ìë³„ ì œí•œ ì„¤ì •

```python
# config/user_limits.py

USER_LIMITS = {
    "free": {
        "daily_trades": 10,
        "max_strategies": 1,
        "max_positions": 5,
        "priority": 0
    },
    "basic": {
        "daily_trades": 50,
        "max_strategies": 3,
        "max_positions": 10,
        "priority": 0
    },
    "premium": {
        "daily_trades": 100,
        "max_strategies": 5,
        "max_positions": 20,
        "priority": 1  # VIP ìš°ì„ ìˆœìœ„
    }
}

# ë™ì‹œì„± ì œì–´
CONCURRENCY_LIMITS = {
    "max_concurrent_users": 10,
    "orders_per_second": 10,
    "api_calls_per_minute": 600,
    "session_timeout_seconds": 300,
    "rotation_interval_seconds": 30
}
```

## ğŸ“Š 10ëª… ì‚¬ìš©ì ì²˜ë¦¬ ëŠ¥ë ¥

### ì˜ˆìƒ ì²˜ë¦¬ëŸ‰
```yaml
ì‹¤ì‹œê°„ ì‹œì„¸:
  - 100ì¢…ëª© ë™ì‹œ êµ¬ë…
  - 1ì´ˆ ë‹¨ìœ„ ì—…ë°ì´íŠ¸
  - ëª¨ë“  ì‚¬ìš©ì ê³µìœ 

ì£¼ë¬¸ ì²˜ë¦¬:
  - ë¶„ë‹¹ 20ê°œ ì£¼ë¬¸
  - ì‚¬ìš©ìë‹¹ 2ê°œ/ë¶„
  - ì¼ì¼ ìµœëŒ€ 1,000ê°œ

ì„¸ì…˜ ê´€ë¦¬:
  - 30ì´ˆ ë¡œí…Œì´ì…˜
  - 3ì´ˆ ì „í™˜ ì‹œê°„
  - 27ì´ˆ í™œì„± ì‹œê°„

ì¼ì¼ í•œë„:
  - Free: 10 ê±°ë˜
  - Basic: 50 ê±°ë˜  
  - Premium: 100 ê±°ë˜
```

### ì„±ëŠ¥ ìµœì í™”
```python
# 1. ì‹¤ì‹œê°„ ì‹œì„¸ëŠ” ê³µìœ 
market_data = cache.get_shared_data()

# 2. ì£¼ë¬¸ì€ ë°°ì¹˜ ì²˜ë¦¬
batch_orders = queue.get_batch(max=5)

# 3. ì„¸ì…˜ ì‚¬ì „ ë¡œë“œ
preload_next_session()

# 4. ìºì‹± í™œìš©
redis_cache.set(key, value, ttl=60)
```

## ğŸ”’ ë³´ì•ˆ ë° ê²©ë¦¬

```yaml
ë°ì´í„° ê²©ë¦¬:
  - Supabase RLS ì •ì±…
  - user_id ê¸°ë°˜ í•„í„°ë§
  - API í‚¤ ì•”í˜¸í™”

ë¦¬ì†ŒìŠ¤ ê²©ë¦¬:
  - ì¼ì¼ ê±°ë˜ í•œë„
  - API í˜¸ì¶œ ì œí•œ
  - ë™ì‹œ ì „ëµ ìˆ˜ ì œí•œ

ì„¸ì…˜ ë³´ì•ˆ:
  - JWT í† í° ì¸ì¦
  - IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
  - 2FA (ì„ íƒ)
```

## ğŸ’° ì˜ˆìƒ ë¹„ìš© (10ëª… ê¸°ì¤€)

```yaml
ì¸í”„ë¼:
  - Windows Server: ì›” 10ë§Œì›
  - NAS/Docker: ë³´ìœ 
  - Supabase Pro: ì›” $25
  - Vercel Pro: ì›” $20

ì´ ì›” ë¹„ìš©: ì•½ 15ë§Œì›
ì‚¬ìš©ìë‹¹: ì›” 1.5ë§Œì›
```

## âœ… ê²°ë¡ 

**10ëª… ê·œëª¨ì—ì„œëŠ” ë‹¨ì¼ Windows ì„œë²„ + ì„¸ì…˜ ê´€ë¦¬ ë°©ì‹ì´ ìµœì **
- ë¹„ìš© íš¨ìœ¨ì  (ì›” 15ë§Œì›)
- ì¶©ë¶„í•œ ì„±ëŠ¥ (ì‚¬ìš©ìë‹¹ 2ì£¼ë¬¸/ë¶„)
- ê°„ë‹¨í•œ ê´€ë¦¬
- í™•ì¥ ê°€ëŠ¥ (20ëª…ê¹Œì§€ ë™ì¼ êµ¬ì¡°)

ì´ êµ¬ì¡°ë¡œ 10ëª…ì˜ ì‚¬ìš©ìê°€ ê°ìì˜ ê³„ì¢Œë¡œ ë™ì‹œì— ìë™ë§¤ë§¤ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.