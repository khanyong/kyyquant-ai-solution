# üöÄ ÌÇ§ÏõÄÏ¶ùÍ∂å REST API Ïã§Ï†Ñ Îß§Îß§ ÏãúÏä§ÌÖú ÌÜµÌï© Í≥ÑÌöç

## üìã ÌîÑÎ°úÏ†ùÌä∏ Í∞úÏöî

ÌòÑÏû¨ React/TypeScript Î∞±ÌÖåÏä§Ìä∏ ÏãúÏä§ÌÖúÏóê ÌÇ§ÏõÄÏ¶ùÍ∂å REST APIÎ•º ÌÜµÌïú Ïã§Ï†Ñ Îß§Îß§ Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÌï©ÎãàÎã§.

### ÌòÑÏû¨ ÏãúÏä§ÌÖú Íµ¨Ï°∞
- **Frontend**: React + TypeScript + MUI
- **Backend**: FastAPI (Î∞±ÌÖåÏä§Ìä∏Ïö©)
- **Database**: Supabase
- **Î∞∞Ìè¨**: Vercel (Frontend)

### Ï∂îÍ∞ÄÎê† Í∏∞Îä•
- ÌÇ§ÏõÄÏ¶ùÍ∂å REST API Ïó∞Îèô
- ÏãúÎÜÄÎ°úÏßÄ NAS Í∏∞Î∞ò ÏûêÎèôÎß§Îß§
- N8N ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏûêÎèôÌôî
- Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏/Îß§Îß§ Ïó∞Îèô

## üèóÔ∏è ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÏ≤ò

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§                     ‚îÇ
‚îÇ            React Frontend (Vercel)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Supabase                        ‚îÇ
‚îÇ         (Database + Authentication + API)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               ÏãúÎÜÄÎ°úÏßÄ NAS (24/7)                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ  ‚îÇ     N8N      ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Trading API  ‚îÇ             ‚îÇ
‚îÇ  ‚îÇ  Workflows   ‚îÇ    ‚îÇ   (FastAPI)   ‚îÇ             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îÇ         ‚Üì                    ‚Üì                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ  ‚îÇ    ÌÇ§ÏõÄ REST API Bridge           ‚îÇ             ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              ÌÇ§ÏõÄÏ¶ùÍ∂å REST API ÏÑúÎ≤Ñ                   ‚îÇ
‚îÇ          https://api.kiwoom.com                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìÅ ÌîÑÎ°úÏ†ùÌä∏ Íµ¨Ï°∞ ÌôïÏû•

```
auto_stock/
‚îú‚îÄ‚îÄ src/                          # Í∏∞Ï°¥ Frontend
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trading/             # üÜï Ïã§Ï†Ñ Îß§Îß§ Ïª¥Ìè¨ÎÑåÌä∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LiveTrading.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OrderPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PositionMonitor.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AccountInfo.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kiwoomApi.ts        # üÜï ÌÇ§ÏõÄ API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îú‚îÄ‚îÄ trading.ts           # üÜï Îß§Îß§ Í¥ÄÎ†® ÌÉÄÏûÖ
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ backend/                      # Í∏∞Ï°¥ Î∞±ÌÖåÏä§Ìä∏ ÏÑúÎ≤Ñ
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ trading-server/              # üÜï Ïã§Ï†Ñ Îß§Îß§ ÏÑúÎ≤Ñ
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ kiwoom/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_client.py       # ÌÇ§ÏõÄ REST API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py             # OAuth Ïù∏Ï¶ù
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py           # Îç∞Ïù¥ÌÑ∞ Î™®Îç∏
‚îÇ   ‚îú‚îÄ‚îÄ strategies/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ executor.py         # Ï†ÑÎûµ Ïã§Ìñâ ÏóîÏßÑ
‚îÇ   ‚îî‚îÄ‚îÄ n8n/
‚îÇ       ‚îú‚îÄ‚îÄ webhooks.py         # N8N ÏõπÌõÖ Ï≤òÎ¶¨
‚îÇ       ‚îî‚îÄ‚îÄ workflows.json      # N8N ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÌÖúÌîåÎ¶ø
‚îÇ
‚îî‚îÄ‚îÄ deployment/                  # üÜï Î∞∞Ìè¨ ÏÑ§Ï†ï
    ‚îú‚îÄ‚îÄ docker-compose.yml       # NAS Docker ÏÑ§Ï†ï
    ‚îú‚îÄ‚îÄ n8n/
    ‚îÇ   ‚îî‚îÄ‚îÄ workflows/
    ‚îî‚îÄ‚îÄ nginx/
        ‚îî‚îÄ‚îÄ nginx.conf
```

## üîß ÌÇ§ÏõÄ REST API ÌÜµÌï© Íµ¨ÌòÑ

### 1. ÌÇ§ÏõÄ API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ (`trading-server/kiwoom/api_client.py`)

```python
import aiohttp
import hashlib
import json
from typing import Dict, Any, Optional
from datetime import datetime

class KiwoomRestAPI:
    """ÌÇ§ÏõÄÏ¶ùÍ∂å REST API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏"""
    
    def __init__(self):
        self.base_url = "https://api.kiwoom.com"
        self.mock_url = "https://mockapi.kiwoom.com"  # Î™®ÏùòÌà¨Ïûê
        self.access_token = None
        self.token_expires = None
        
    async def authenticate(self, app_key: str, secret_key: str) -> str:
        """OAuth 2.0 Ïù∏Ï¶ù"""
        async with aiohttp.ClientSession() as session:
            url = f"{self.base_url}/oauth2/token"
            
            # Client credentials grant
            data = {
                "grant_type": "client_credentials",
                "client_id": app_key,
                "client_secret": secret_key
            }
            
            async with session.post(url, data=data) as resp:
                result = await resp.json()
                self.access_token = result["access_token"]
                self.token_expires = datetime.now().timestamp() + result["expires_in"]
                return self.access_token
    
    async def get_current_price(self, stock_code: str) -> Dict[str, Any]:
        """ÌòÑÏû¨Í∞Ä Ï°∞Ìöå"""
        headers = self._get_headers()
        
        async with aiohttp.ClientSession() as session:
            url = f"{self.base_url}/stock/price"
            params = {"stock_code": stock_code}
            
            async with session.get(url, headers=headers, params=params) as resp:
                return await resp.json()
    
    async def place_order(self, order_data: Dict[str, Any]) -> Dict[str, Any]:
        """Ï£ºÎ¨∏ Ïã§Ìñâ"""
        headers = self._get_headers()
        
        async with aiohttp.ClientSession() as session:
            url = f"{self.base_url}/trading/order"
            
            async with session.post(url, headers=headers, json=order_data) as resp:
                return await resp.json()
    
    async def get_balance(self, account_no: str) -> Dict[str, Any]:
        """Í≥ÑÏ¢å ÏûîÍ≥† Ï°∞Ìöå"""
        headers = self._get_headers()
        
        async with aiohttp.ClientSession() as session:
            url = f"{self.base_url}/account/balance"
            params = {"account_no": account_no}
            
            async with session.get(url, headers=headers, params=params) as resp:
                return await resp.json()
    
    async def get_positions(self, account_no: str) -> Dict[str, Any]:
        """Î≥¥Ïú† Ï¢ÖÎ™© Ï°∞Ìöå"""
        headers = self._get_headers()
        
        async with aiohttp.ClientSession() as session:
            url = f"{self.base_url}/account/positions"
            params = {"account_no": account_no}
            
            async with session.get(url, headers=headers, params=params) as resp:
                return await resp.json()
    
    async def subscribe_realtime(self, stock_codes: list, callback):
        """Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏ Íµ¨ÎèÖ (WebSocket)"""
        ws_url = self.base_url.replace("https", "wss") + "/realtime"
        
        async with aiohttp.ClientSession() as session:
            async with session.ws_connect(ws_url) as ws:
                # Ïù∏Ï¶ù
                await ws.send_json({
                    "type": "auth",
                    "token": self.access_token
                })
                
                # Ï¢ÖÎ™© Íµ¨ÎèÖ
                await ws.send_json({
                    "type": "subscribe",
                    "stocks": stock_codes
                })
                
                # Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏàòÏã†
                async for msg in ws:
                    if msg.type == aiohttp.WSMsgType.TEXT:
                        data = json.loads(msg.data)
                        await callback(data)
    
    def _get_headers(self) -> Dict[str, str]:
        """API Ìó§Îçî ÏÉùÏÑ±"""
        return {
            "Authorization": f"Bearer {self.access_token}",
            "Content-Type": "application/json"
        }
```

### 2. FastAPI Îß§Îß§ ÏÑúÎ≤Ñ (`trading-server/main.py`)

```python
from fastapi import FastAPI, HTTPException, BackgroundTasks
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from typing import Dict, Any, Optional
import asyncio
from datetime import datetime

from kiwoom.api_client import KiwoomRestAPI
from strategies.executor import StrategyExecutor
from supabase import create_client, Client

app = FastAPI(title="ÌÇ§ÏõÄ Ïã§Ï†Ñ Îß§Îß§ ÏÑúÎ≤Ñ")

# CORS ÏÑ§Ï†ï
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Ï†ÑÏó≠ Î≥ÄÏàò
kiwoom_api = KiwoomRestAPI()
strategy_executor = StrategyExecutor()
supabase: Client = None

class OrderRequest(BaseModel):
    user_id: str
    stock_code: str
    order_type: str  # buy, sell
    quantity: int
    price_type: str  # market, limit
    price: Optional[float] = None

class StrategyStart(BaseModel):
    user_id: str
    strategy_id: str
    account_no: str
    investment_amount: float

@app.on_event("startup")
async def startup_event():
    """ÏÑúÎ≤Ñ ÏãúÏûë Ïãú Ï¥àÍ∏∞Ìôî"""
    global supabase
    
    # Supabase Ïó∞Í≤∞
    supabase = create_client(
        "YOUR_SUPABASE_URL",
        "YOUR_SUPABASE_KEY"
    )
    
    # ÌÇ§ÏõÄ API Ïù∏Ï¶ù
    await kiwoom_api.authenticate(
        app_key="YOUR_APP_KEY",
        secret_key="YOUR_SECRET_KEY"
    )
    
    print("‚úÖ ÌÇ§ÏõÄ Îß§Îß§ ÏÑúÎ≤Ñ ÏãúÏûë")

@app.get("/")
async def root():
    return {"message": "ÌÇ§ÏõÄÏ¶ùÍ∂å Ïã§Ï†Ñ Îß§Îß§ ÏÑúÎ≤Ñ", "status": "running"}

@app.get("/api/market/price/{stock_code}")
async def get_price(stock_code: str):
    """ÌòÑÏû¨Í∞Ä Ï°∞Ìöå"""
    try:
        price_data = await kiwoom_api.get_current_price(stock_code)
        return price_data
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/trading/order")
async def place_order(order: OrderRequest):
    """Ï£ºÎ¨∏ Ïã§Ìñâ"""
    try:
        # ÏÇ¨Ïö©Ïûê Ïù∏Ï¶ù ÌôïÏù∏
        user = supabase.table("users").select("*").eq("id", order.user_id).single().execute()
        if not user.data:
            raise HTTPException(status_code=401, detail="Unauthorized")
        
        # ÌÇ§ÏõÄ APIÎ°ú Ï£ºÎ¨∏ Ï†ÑÏÜ°
        order_data = {
            "account_no": user.data["kiwoom_account"],
            "stock_code": order.stock_code,
            "order_type": order.order_type,
            "quantity": order.quantity,
            "price_type": order.price_type,
            "price": order.price
        }
        
        result = await kiwoom_api.place_order(order_data)
        
        # Ï£ºÎ¨∏ Í∏∞Î°ù Ï†ÄÏû•
        supabase.table("orders").insert({
            "user_id": order.user_id,
            "stock_code": order.stock_code,
            "order_type": order.order_type,
            "quantity": order.quantity,
            "price": order.price,
            "status": "submitted",
            "order_id": result["order_id"],
            "created_at": datetime.now().isoformat()
        }).execute()
        
        return result
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/account/balance/{user_id}")
async def get_balance(user_id: str):
    """Í≥ÑÏ¢å ÏûîÍ≥† Ï°∞Ìöå"""
    try:
        # ÏÇ¨Ïö©Ïûê Í≥ÑÏ¢å Ï†ïÎ≥¥ Ï°∞Ìöå
        user = supabase.table("users").select("kiwoom_account").eq("id", user_id).single().execute()
        if not user.data:
            raise HTTPException(status_code=404, detail="User not found")
        
        balance = await kiwoom_api.get_balance(user.data["kiwoom_account"])
        return balance
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.get("/api/account/positions/{user_id}")
async def get_positions(user_id: str):
    """Î≥¥Ïú† Ï¢ÖÎ™© Ï°∞Ìöå"""
    try:
        user = supabase.table("users").select("kiwoom_account").eq("id", user_id).single().execute()
        if not user.data:
            raise HTTPException(status_code=404, detail="User not found")
        
        positions = await kiwoom_api.get_positions(user.data["kiwoom_account"])
        return positions
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/strategy/start")
async def start_strategy(strategy: StrategyStart, background_tasks: BackgroundTasks):
    """Ï†ÑÎûµ Ïã§Ìñâ ÏãúÏûë"""
    try:
        # Ï†ÑÎûµ Ï†ïÎ≥¥ Ï°∞Ìöå
        strategy_data = supabase.table("strategies").select("*").eq("id", strategy.strategy_id).single().execute()
        if not strategy_data.data:
            raise HTTPException(status_code=404, detail="Strategy not found")
        
        # Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú Ï†ÑÎûµ Ïã§Ìñâ
        background_tasks.add_task(
            strategy_executor.run_strategy,
            user_id=strategy.user_id,
            strategy_config=strategy_data.data,
            account_no=strategy.account_no,
            investment_amount=strategy.investment_amount
        )
        
        return {"message": "Ï†ÑÎûµ Ïã§Ìñâ ÏãúÏûë", "strategy_id": strategy.strategy_id}
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/api/strategy/stop/{strategy_id}")
async def stop_strategy(strategy_id: str):
    """Ï†ÑÎûµ Ïã§Ìñâ Ï§ëÏßÄ"""
    try:
        await strategy_executor.stop_strategy(strategy_id)
        return {"message": "Ï†ÑÎûµ Ïã§Ìñâ Ï§ëÏßÄ", "strategy_id": strategy_id}
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.websocket("/ws/realtime/{stock_codes}")
async def websocket_endpoint(websocket, stock_codes: str):
    """Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏ WebSocket"""
    await websocket.accept()
    
    stocks = stock_codes.split(",")
    
    async def send_price(data):
        await websocket.send_json(data)
    
    try:
        await kiwoom_api.subscribe_realtime(stocks, send_price)
    except Exception as e:
        await websocket.send_json({"error": str(e)})
    finally:
        await websocket.close()

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8001)
```

### 3. N8N ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏÑ§Ï†ï

```json
{
  "name": "ÌÇ§ÏõÄ ÏûêÎèôÎß§Îß§ ÏõåÌÅ¨ÌîåÎ°úÏö∞",
  "nodes": [
    {
      "id": "1",
      "type": "n8n-nodes-base.cron",
      "name": "Îß§Ïùº 09:00 ÏãúÏûë",
      "parameters": {
        "cronExpression": "0 9 * * 1-5"
      }
    },
    {
      "id": "2",
      "type": "n8n-nodes-base.httpRequest",
      "name": "Ï†ÑÎûµ Î™©Î°ù Ï°∞Ìöå",
      "parameters": {
        "url": "http://trading-api:8001/api/strategies/active",
        "method": "GET"
      }
    },
    {
      "id": "3",
      "type": "n8n-nodes-base.function",
      "name": "Ï†ÑÎûµ ÌïÑÌÑ∞ÎßÅ",
      "parameters": {
        "code": "return items.filter(item => item.json.enabled === true);"
      }
    },
    {
      "id": "4",
      "type": "n8n-nodes-base.httpRequest",
      "name": "Ï†ÑÎûµ Ïã§Ìñâ",
      "parameters": {
        "url": "http://trading-api:8001/api/strategy/start",
        "method": "POST",
        "body": "={{ $json }}"
      }
    },
    {
      "id": "5",
      "type": "n8n-nodes-base.webhook",
      "name": "Í±∞Îûò Ïã†Ìò∏ ÏàòÏã†",
      "parameters": {
        "path": "trading-signal",
        "method": "POST"
      }
    },
    {
      "id": "6",
      "type": "n8n-nodes-base.httpRequest",
      "name": "Ï£ºÎ¨∏ Ïã§Ìñâ",
      "parameters": {
        "url": "http://trading-api:8001/api/trading/order",
        "method": "POST"
      }
    }
  ]
}
```

### 4. Docker Compose ÏÑ§Ï†ï (`deployment/docker-compose.yml`)

```yaml
version: '3.8'

services:
  # N8N ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏóîÏßÑ
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n-trading
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=${N8N_PASSWORD}
      - N8N_HOST=0.0.0.0
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://your-nas-ip:5678/
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY}
    volumes:
      - ./n8n/data:/home/node/.n8n
      - ./n8n/files:/files
    restart: unless-stopped
    networks:
      - trading-network

  # ÌÇ§ÏõÄ Îß§Îß§ API ÏÑúÎ≤Ñ
  trading-api:
    build: ../trading-server
    container_name: trading-api
    ports:
      - "8001:8001"
    environment:
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      - KIWOOM_APP_KEY=${KIWOOM_APP_KEY}
      - KIWOOM_SECRET_KEY=${KIWOOM_SECRET_KEY}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
    volumes:
      - ./logs:/app/logs
    depends_on:
      - redis
    restart: unless-stopped
    networks:
      - trading-network

  # Redis (Ï∫êÏã± Î∞è ÌÅê)
  redis:
    image: redis:7-alpine
    container_name: trading-redis
    ports:
      - "6379:6379"
    volumes:
      - ./redis/data:/data
    command: redis-server --appendonly yes
    restart: unless-stopped
    networks:
      - trading-network

  # Nginx Î¶¨Î≤ÑÏä§ ÌîÑÎ°ùÏãú
  nginx:
    image: nginx:alpine
    container_name: trading-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - trading-api
      - n8n
    restart: unless-stopped
    networks:
      - trading-network

networks:
  trading-network:
    driver: bridge

volumes:
  n8n-data:
  redis-data:
```

### 5. Frontend ÌÜµÌï© (`src/components/trading/LiveTrading.tsx`)

```typescript
import React, { useState, useEffect } from 'react';
import {
  Box,
  Card,
  CardContent,
  Grid,
  Typography,
  Button,
  TextField,
  Select,
  MenuItem,
  Alert,
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableRow,
  Chip
} from '@mui/material';
import { useTradingApi } from '../../hooks/useTradingApi';
import { Position, Order, Balance } from '../../types/trading';

export const LiveTrading: React.FC = () => {
  const [positions, setPositions] = useState<Position[]>([]);
  const [balance, setBalance] = useState<Balance | null>(null);
  const [orderForm, setOrderForm] = useState({
    stockCode: '',
    orderType: 'buy',
    quantity: 0,
    priceType: 'market',
    price: 0
  });
  
  const { 
    fetchPositions, 
    fetchBalance, 
    placeOrder,
    subscribeRealtime 
  } = useTradingApi();

  useEffect(() => {
    // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    loadAccountData();
    
    // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ Íµ¨ÎèÖ
    const unsubscribe = subscribeRealtime(['005930', '000660'], (data) => {
      console.log('Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞:', data);
      // Ïã§ÏãúÍ∞Ñ Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏ Ï≤òÎ¶¨
    });
    
    return () => unsubscribe();
  }, []);

  const loadAccountData = async () => {
    try {
      const [posData, balData] = await Promise.all([
        fetchPositions(),
        fetchBalance()
      ]);
      setPositions(posData);
      setBalance(balData);
    } catch (error) {
      console.error('Í≥ÑÏ¢å Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
    }
  };

  const handleOrder = async () => {
    try {
      const result = await placeOrder(orderForm);
      if (result.success) {
        alert('Ï£ºÎ¨∏Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.');
        loadAccountData(); // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
      }
    } catch (error) {
      alert('Ï£ºÎ¨∏ Ïã§Ìå®: ' + error.message);
    }
  };

  return (
    <Box sx={{ p: 3 }}>
      <Typography variant="h4" gutterBottom>
        Ïã§Ï†Ñ Îß§Îß§
      </Typography>

      <Grid container spacing={3}>
        {/* Í≥ÑÏ¢å Ï†ïÎ≥¥ */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                Í≥ÑÏ¢å Ï†ïÎ≥¥
              </Typography>
              {balance && (
                <>
                  <Typography>
                    ÏòàÏàòÍ∏à: {balance.cash.toLocaleString()}Ïõê
                  </Typography>
                  <Typography>
                    ÌèâÍ∞ÄÍ∏àÏï°: {balance.totalValue.toLocaleString()}Ïõê
                  </Typography>
                  <Typography>
                    ÏÜêÏùµ: {balance.profit.toLocaleString()}Ïõê
                    <Chip 
                      label={`${balance.profitRate}%`}
                      color={balance.profit > 0 ? 'success' : 'error'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Typography>
                </>
              )}
            </CardContent>
          </Card>
        </Grid>

        {/* Ï£ºÎ¨∏ Ìå®ÎÑê */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                Ï£ºÎ¨∏
              </Typography>
              <Grid container spacing={2}>
                <Grid item xs={6}>
                  <TextField
                    fullWidth
                    label="Ï¢ÖÎ™©ÏΩîÎìú"
                    value={orderForm.stockCode}
                    onChange={(e) => setOrderForm({
                      ...orderForm,
                      stockCode: e.target.value
                    })}
                  />
                </Grid>
                <Grid item xs={6}>
                  <Select
                    fullWidth
                    value={orderForm.orderType}
                    onChange={(e) => setOrderForm({
                      ...orderForm,
                      orderType: e.target.value
                    })}
                  >
                    <MenuItem value="buy">Îß§Ïàò</MenuItem>
                    <MenuItem value="sell">Îß§ÎèÑ</MenuItem>
                  </Select>
                </Grid>
                <Grid item xs={6}>
                  <TextField
                    fullWidth
                    type="number"
                    label="ÏàòÎüâ"
                    value={orderForm.quantity}
                    onChange={(e) => setOrderForm({
                      ...orderForm,
                      quantity: parseInt(e.target.value)
                    })}
                  />
                </Grid>
                <Grid item xs={6}>
                  <Select
                    fullWidth
                    value={orderForm.priceType}
                    onChange={(e) => setOrderForm({
                      ...orderForm,
                      priceType: e.target.value
                    })}
                  >
                    <MenuItem value="market">ÏãúÏû•Í∞Ä</MenuItem>
                    <MenuItem value="limit">ÏßÄÏ†ïÍ∞Ä</MenuItem>
                  </Select>
                </Grid>
                {orderForm.priceType === 'limit' && (
                  <Grid item xs={12}>
                    <TextField
                      fullWidth
                      type="number"
                      label="ÏßÄÏ†ïÍ∞ÄÍ≤©"
                      value={orderForm.price}
                      onChange={(e) => setOrderForm({
                        ...orderForm,
                        price: parseFloat(e.target.value)
                      })}
                    />
                  </Grid>
                )}
                <Grid item xs={12}>
                  <Button
                    variant="contained"
                    color={orderForm.orderType === 'buy' ? 'error' : 'primary'}
                    onClick={handleOrder}
                    fullWidth
                  >
                    {orderForm.orderType === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'} Ï£ºÎ¨∏
                  </Button>
                </Grid>
              </Grid>
            </CardContent>
          </Card>
        </Grid>

        {/* Î≥¥Ïú† Ï¢ÖÎ™© */}
        <Grid item xs={12}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                Î≥¥Ïú† Ï¢ÖÎ™©
              </Typography>
              <Table>
                <TableHead>
                  <TableRow>
                    <TableCell>Ï¢ÖÎ™©Î™Ö</TableCell>
                    <TableCell>Î≥¥Ïú†ÏàòÎüâ</TableCell>
                    <TableCell>ÌèâÍ∑†Îã®Í∞Ä</TableCell>
                    <TableCell>ÌòÑÏû¨Í∞Ä</TableCell>
                    <TableCell>ÌèâÍ∞ÄÍ∏àÏï°</TableCell>
                    <TableCell>ÏÜêÏùµ</TableCell>
                    <TableCell>ÏàòÏùµÎ•†</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {positions.map((position) => (
                    <TableRow key={position.stockCode}>
                      <TableCell>{position.stockName}</TableCell>
                      <TableCell>{position.quantity}</TableCell>
                      <TableCell>{position.avgPrice.toLocaleString()}</TableCell>
                      <TableCell>{position.currentPrice.toLocaleString()}</TableCell>
                      <TableCell>{position.evalAmount.toLocaleString()}</TableCell>
                      <TableCell>
                        <Typography 
                          color={position.profit > 0 ? 'success.main' : 'error.main'}
                        >
                          {position.profit.toLocaleString()}
                        </Typography>
                      </TableCell>
                      <TableCell>
                        <Chip
                          label={`${position.profitRate.toFixed(2)}%`}
                          color={position.profitRate > 0 ? 'success' : 'error'}
                          size="small"
                        />
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};
```

## üìù Íµ¨ÌòÑ Î°úÎìúÎßµ

### Phase 1: Í∏∞Ï¥à ÏÑ§Ï†ï (1Ï£º)
- [ ] ÌÇ§ÏõÄ REST API Ïï± Îì±Î°ù Î∞è Ïù∏Ï¶ù ÌÇ§ Î∞úÍ∏â
- [ ] ÏãúÎÜÄÎ°úÏßÄ NAS Docker ÌôòÍ≤Ω Íµ¨ÏÑ±
- [ ] Supabase ÌÖåÏù¥Î∏î Ïä§ÌÇ§Îßà ÌôïÏû• (users, orders, positions)

### Phase 2: Î∞±ÏóîÎìú Íµ¨ÌòÑ (2Ï£º)
- [ ] ÌÇ§ÏõÄ REST API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Í∞úÎ∞ú
- [ ] FastAPI Îß§Îß§ ÏÑúÎ≤Ñ Íµ¨ÌòÑ
- [ ] Ï†ÑÎûµ Ïã§Ìñâ ÏóîÏßÑ Í∞úÎ∞ú
- [ ] WebSocket Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏ Ïó∞Îèô

### Phase 3: Frontend ÌÜµÌï© (1Ï£º)
- [ ] Ïã§Ï†Ñ Îß§Îß§ Ïª¥Ìè¨ÎÑåÌä∏ Í∞úÎ∞ú
- [ ] Í≥ÑÏ¢å Ï†ïÎ≥¥ ÌëúÏãú UI
- [ ] Ï£ºÎ¨∏ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Íµ¨ÌòÑ
- [ ] Ïã§ÏãúÍ∞Ñ ÏãúÏÑ∏ ÏóÖÎç∞Ïù¥Ìä∏

### Phase 4: N8N ÏõåÌÅ¨ÌîåÎ°úÏö∞ (1Ï£º)
- [ ] ÏûêÎèôÎß§Îß§ ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏÑ§Í≥Ñ
- [ ] Ï°∞Í±¥Î∂Ä Îß§Îß§ Î°úÏßÅ Íµ¨ÌòÑ
- [ ] ÏïåÎ¶º ÏãúÏä§ÌÖú Ïó∞Îèô
- [ ] Î∞±ÌÖåÏä§Ìä∏-Ïã§Ï†Ñ Ïó∞Í≥Ñ

### Phase 5: ÌÖåÏä§Ìä∏ Î∞è ÏµúÏ†ÅÌôî (1Ï£º)
- [ ] Î™®ÏùòÌà¨Ïûê ÌôòÍ≤Ω ÌÖåÏä§Ìä∏
- [ ] ÏÑ±Îä• ÏµúÏ†ÅÌôî
- [ ] ÏóêÎü¨ Ï≤òÎ¶¨ Í∞ïÌôî
- [ ] Î≥¥Ïïà Ï†êÍ≤Ä

## üîí Î≥¥Ïïà Í≥†Î†§ÏÇ¨Ìï≠

1. **API ÌÇ§ Í¥ÄÎ¶¨**
   - ÌôòÍ≤Ω Î≥ÄÏàòÎ°ú Í¥ÄÎ¶¨
   - Supabase Vault ÌôúÏö©
   - ÌÇ§ Î°úÌÖåÏù¥ÏÖò Ï†ïÏ±Ö

2. **Ï†ëÍ∑º Ï†úÏñ¥**
   - JWT Í∏∞Î∞ò Ïù∏Ï¶ù
   - IP ÌôîÏù¥Ìä∏Î¶¨Ïä§Ìä∏
   - Rate limiting

3. **Îç∞Ïù¥ÌÑ∞ Î≥¥Ìò∏**
   - HTTPS ÌÜµÏã†
   - ÎØºÍ∞ê Ï†ïÎ≥¥ ÏïîÌò∏Ìôî
   - Î°úÍ∑∏ ÎßàÏä§ÌÇπ

## üìä Î™®ÎãàÌÑ∞ÎßÅ

1. **ÏãúÏä§ÌÖú Î™®ÎãàÌÑ∞ÎßÅ**
   - Prometheus + Grafana
   - ÏÑúÎ≤Ñ ÏÉÅÌÉú Ï≤¥ÌÅ¨
   - API ÏùëÎãµ ÏãúÍ∞Ñ

2. **Í±∞Îûò Î™®ÎãàÌÑ∞ÎßÅ**
   - Ïã§ÏãúÍ∞Ñ ÏÜêÏùµ Ï∂îÏ†Å
   - Ïù¥ÏÉÅ Í±∞Îûò Í∞êÏßÄ
   - ÏùºÏùº Î¶¨Ìè¨Ìä∏

## üöÄ Î∞∞Ìè¨ ÌîÑÎ°úÏÑ∏Ïä§

```bash
# 1. NASÏóê Docker ÏÑ§Ïπò (Container Manager)

# 2. Git ÌÅ¥Î°†
git clone https://github.com/your-repo/auto_stock.git
cd auto_stock

# 3. ÌôòÍ≤Ω Î≥ÄÏàò ÏÑ§Ï†ï
cp .env.example .env
# .env ÌååÏùº Ìé∏Ïßë

# 4. Docker Compose Ïã§Ìñâ
cd deployment
docker-compose up -d

# 5. N8N ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏûÑÌè¨Ìä∏
# N8N UIÏóêÏÑú ÏõåÌÅ¨ÌîåÎ°úÏö∞ JSON ÏûÑÌè¨Ìä∏

# 6. ÏãúÏä§ÌÖú ÌôïÏù∏
docker-compose ps
curl http://localhost:8001/
```

## üìö Ï∞∏Í≥† ÏûêÎ£å

- [ÌÇ§ÏõÄ REST API Î¨∏ÏÑú](https://openapi.kiwoom.com/guide/apiguide)
- [N8N Î¨∏ÏÑú](https://docs.n8n.io/)
- [ÏãúÎÜÄÎ°úÏßÄ Docker Í∞ÄÏù¥Îìú](https://www.synology.com/ko-kr/dsm/packages/Docker)
- [Supabase Î¨∏ÏÑú](https://supabase.com/docs)

## ‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠

1. **Ïã§Ï†Ñ Í±∞Îûò Ï†Ñ Ï∂©Î∂ÑÌïú ÌÖåÏä§Ìä∏**
   - Î™®ÏùòÌà¨ÏûêÎ°ú ÏµúÏÜå 1Í∞úÏõî ÌÖåÏä§Ìä∏
   - ÏÜåÏï°ÏúºÎ°ú ÏãúÏûë
   - ÏÜêÏ†à Î°úÏßÅ ÌïÑÏàò

2. **ÏãúÏä§ÌÖú ÏïàÏ†ïÏÑ±**
   - UPS Ï†ÑÏõê Î≥¥Ìò∏
   - ÏûêÎèô Ïû¨ÏãúÏûë ÏÑ§Ï†ï
   - Î∞±ÏóÖ ÏãúÏä§ÌÖú Íµ¨Ï∂ï

3. **Î≤ïÏ†Å Ï§ÄÏàòÏÇ¨Ìï≠**
   - ÏïåÍ≥†Î¶¨Ï¶ò Í±∞Îûò Ïã†Í≥†
   - ÏãúÏû• Ï°∞Ïûë Í∏àÏßÄ
   - Í∞úÏù∏Ï†ïÎ≥¥ Î≥¥Ìò∏