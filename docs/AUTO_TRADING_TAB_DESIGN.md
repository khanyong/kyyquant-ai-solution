# ìë™ë§¤ë§¤ íƒ­ ì„¤ê³„ ë¬¸ì„œ

## UI êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ìë™ë§¤ë§¤                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 1. ì „ëµ ì„ íƒ                                â”‚      â”‚
â”‚  â”‚   [ë“œë¡­ë‹¤ìš´: ì „ëµ ì„ íƒ...]                   â”‚      â”‚
â”‚  â”‚   ì„ íƒëœ ì „ëµ: [ë¶„í• ] RSI 3ë‹¨ê³„ ë§¤ìˆ˜ë§¤ë„       â”‚      â”‚
â”‚  â”‚   ë§¤ìˆ˜ì¡°ê±´: RSI < 35, 28, 22               â”‚      â”‚
â”‚  â”‚   ë§¤ë„ì¡°ê±´: ì—†ìŒ                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 2. íˆ¬ììœ ë‹ˆë²„ìŠ¤ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)        â”‚      â”‚
â”‚  â”‚   â˜‘ ê¸°ë³¸í•„í„° (446ê°œ ì¢…ëª©)                  â”‚      â”‚
â”‚  â”‚   â˜ ëŒ€í˜•ì£¼ í•„í„° (120ê°œ ì¢…ëª©)               â”‚      â”‚
â”‚  â”‚   â˜ ì„±ì¥ì£¼ í•„í„° (89ê°œ ì¢…ëª©)                â”‚      â”‚
â”‚  â”‚   [+ ìƒˆ í•„í„° ë§Œë“¤ê¸°]                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3. ìë™ë§¤ë§¤ ì„¤ì •                            â”‚      â”‚
â”‚  â”‚   í¬ì§€ì…˜ í¬ê¸°: [1,000,000] ì›               â”‚      â”‚
â”‚  â”‚   ìµœëŒ€ ë³´ìœ  ì¢…ëª©: [5] ê°œ                    â”‚      â”‚
â”‚  â”‚   ì†ì ˆë¼ì¸: [-5] %                          â”‚      â”‚
â”‚  â”‚   ëª©í‘œìˆ˜ìµ: [10] %                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                       â”‚
â”‚  [ìë™ë§¤ë§¤ ì‹œì‘]  [ì¤‘ì§€]                             â”‚
â”‚                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  í™œì„± ìë™ë§¤ë§¤ í˜„í™©                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì „ëµëª…        â”‚ ìœ ë‹ˆë²„ìŠ¤ â”‚ ìƒíƒœ  â”‚ ë§ˆì§€ë§‰ì‹¤í–‰ â”‚ ì‹ í˜¸  â”‚
â”‚  RSI 3ë‹¨ê³„    â”‚ 2ê°œ      â”‚ ğŸŸ¢í™œì„± â”‚ 1ë¶„ ì „    â”‚ 3ê°œ   â”‚
â”‚  ë³¼ë¦°ì €ë°´ë“œ    â”‚ 1ê°œ      â”‚ ğŸŸ¢í™œì„± â”‚ 2ë¶„ ì „    â”‚ 0ê°œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë°ì´í„° íë¦„

### ìë™ë§¤ë§¤ ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ:

```typescript
async function startAutoTrading() {
  // 1. ì „ëµ ì—…ë°ì´íŠ¸ (auto_execute = true)
  await supabase
    .from('strategies')
    .update({
      auto_execute: true,
      auto_trade_enabled: true,
      is_active: true
    })
    .eq('id', selectedStrategyId);

  // 2. ì„ íƒëœ íˆ¬ììœ ë‹ˆë²„ìŠ¤ë“¤ê³¼ ì—°ê²°
  const connections = selectedFilters.map(filterId => ({
    strategy_id: selectedStrategyId,
    investment_filter_id: filterId,
    is_active: true
  }));

  await supabase
    .from('strategy_universes')
    .upsert(connections, {
      onConflict: 'strategy_id,investment_filter_id'
    });

  // 3. ì„±ê³µ ë©”ì‹œì§€
  toast.success('ìë™ë§¤ë§¤ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
}
```

### ìë™ë§¤ë§¤ ì¤‘ì§€ ë²„íŠ¼ í´ë¦­ ì‹œ:

```typescript
async function stopAutoTrading() {
  // 1. ì „ëµ ë¹„í™œì„±í™”
  await supabase
    .from('strategies')
    .update({
      auto_execute: false,
      auto_trade_enabled: false
    })
    .eq('id', selectedStrategyId);

  // 2. ì—°ê²°ëœ ìœ ë‹ˆë²„ìŠ¤ ë¹„í™œì„±í™”
  await supabase
    .from('strategy_universes')
    .update({ is_active: false })
    .eq('strategy_id', selectedStrategyId);

  toast.success('ìë™ë§¤ë§¤ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
```

## 3. Realtime ì—…ë°ì´íŠ¸

```typescript
// ìë™ë§¤ë§¤ ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
useEffect(() => {
  const channel = supabase
    .channel('auto_trading_status')
    .on('postgres_changes', {
      event: 'UPDATE',
      schema: 'public',
      table: 'strategies',
      filter: `auto_execute=eq.true`
    }, (payload) => {
      // ìë™ë§¤ë§¤ ìƒíƒœ ì—…ë°ì´íŠ¸
      updateAutoTradingStatus(payload.new);
    })
    .subscribe();

  return () => {
    supabase.removeChannel(channel);
  };
}, []);
```

## 4. í™œì„± ìë™ë§¤ë§¤ í˜„í™© ì¡°íšŒ

```typescript
async function fetchActiveAutoTrading() {
  const { data, error } = await supabase
    .rpc('get_active_strategies_with_universe');

  // ì „ëµë³„ë¡œ ê·¸ë£¹í™”
  const grouped = data.reduce((acc, item) => {
    if (!acc[item.strategy_id]) {
      acc[item.strategy_id] = {
        strategy_id: item.strategy_id,
        strategy_name: item.strategy_name,
        universes: [],
        last_executed: item.last_signal_at
      };
    }
    acc[item.strategy_id].universes.push({
      filter_id: item.filter_id,
      filter_name: item.filter_name,
      stocks_count: item.filtered_stocks.length
    });
    return acc;
  }, {});

  return Object.values(grouped);
}
```

## 5. ì•ˆì „ì¥ì¹˜

### ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
```typescript
async function validateBeforeStart() {
  // ì´ë¯¸ í™œì„±í™”ëœ ê°™ì€ ì „ëµì´ ìˆëŠ”ì§€ ì²´í¬
  const { data: existing } = await supabase
    .from('strategies')
    .select('id, name')
    .eq('id', selectedStrategyId)
    .eq('auto_execute', true)
    .single();

  if (existing) {
    return confirm('ì´ë¯¸ í™œì„±í™”ëœ ì „ëµì…ë‹ˆë‹¤. ì¬ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
  }
  return true;
}
```

### ìµœëŒ€ ë™ì‹œ ì‹¤í–‰ ì œí•œ
```typescript
async function checkMaxConcurrent() {
  const { count } = await supabase
    .from('strategies')
    .select('*', { count: 'exact', head: true })
    .eq('auto_execute', true)
    .eq('is_active', true);

  const MAX_CONCURRENT = 5;
  if (count >= MAX_CONCURRENT) {
    throw new Error(`ìµœëŒ€ ${MAX_CONCURRENT}ê°œê¹Œì§€ë§Œ ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.`);
  }
}
```

## 6. ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

```typescript
// ì‹¤ì‹œê°„ ì‹ í˜¸ ì¹´ìš´íŠ¸
const { data: signals } = await supabase
  .from('trading_signals')
  .select('*')
  .eq('strategy_id', strategyId)
  .gte('created_at', new Date(Date.now() - 24*60*60*1000).toISOString())
  .order('created_at', { ascending: false });

// ì‹ í˜¸ í†µê³„
const stats = {
  total: signals.length,
  buy: signals.filter(s => s.signal_type === 'BUY').length,
  sell: signals.filter(s => s.signal_type === 'SELL').length,
  lastSignal: signals[0]?.created_at
};
```

## 7. ì—ëŸ¬ ì²˜ë¦¬

```typescript
try {
  await startAutoTrading();
} catch (error) {
  if (error.code === '23505') {
    toast.error('ì´ë¯¸ ê°™ì€ ì¡°í•©ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
  } else if (error.code === '23503') {
    toast.error('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì „ëµ ë˜ëŠ” í•„í„°ì…ë‹ˆë‹¤.');
  } else {
    toast.error('ìë™ë§¤ë§¤ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
  }
}
```
